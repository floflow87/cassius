CrÃ©ation dâ€™une organisation Ã  chaque inscription (register-cabinet)

Je souhaite que Cassius fonctionne comme un vrai SaaS multi-cabinets.

Objectif :
Quand un nouveau cabinet sâ€™inscrit, je veux :

crÃ©er automatiquement une organisation (cabinet),

crÃ©er un user ADMIN rattachÃ© Ã  cette organisation,

renvoyer un JWT contenant organisationId,

et que ce cabinet ait ensuite ses donnÃ©es totalement isolÃ©es des autres.

Merci de faire les actions suivantes :

1. CrÃ©er un nouvel endpoint dâ€™inscription â€œcabinetâ€

Dans server/auth.ts (ou un fichier auth Ã©quivalent), ajouter une nouvelle route :

POST /api/auth/register-cabinet

avec un body de ce type :

{
  "organisationName": "Cabinet Dr Martin",
  "username": "dr.martin",
  "password": "Cassius2025!",
  "nom": "Martin",
  "prenom": "Jean"
}


Cette route doit :

CrÃ©er une nouvelle entrÃ©e dans la table organisations (ou cabinets) dÃ©finie dans shared/schema.ts :

nom = organisationName

CrÃ©er un utilisateur associÃ© avec :

organisationId = id de cette nouvelle organisation

role = "ADMIN" (conformÃ©ment Ã  mon choix produit)

username, password hashÃ©, nom, prenom

2. GÃ©nÃ©rer et renvoyer un JWT pour ce nouvel admin

AprÃ¨s crÃ©ation de lâ€™utilisateur admin :

GÃ©nÃ©rer un token JWT via generateToken(...) avec le payload suivant :

{
  userId: user.id,
  username: user.username,
  role: user.role,           // ADMIN
  organisationId: user.organisationId
}


Renvoyer en rÃ©ponse JSON quelque chose comme :

{
  "token": "<JWT_ICI>",
  "user": {
    "id": "...",
    "username": "dr.martin",
    "role": "ADMIN",
    "organisationId": "<ID_ORG>",
    "nom": "Martin",
    "prenom": "Jean"
  },
  "organisation": {
    "id": "<ID_ORG>",
    "nom": "Cabinet Dr Martin"
  }
}

3. Laisser default-org-001 uniquement pour les donnÃ©es existantes

Garder lâ€™organisation "default-org-001" uniquement pour :

les utilisateurs / donnÃ©es de test actuels,

les comptes internes si besoin.

Les nouveaux cabinets crÃ©Ã©s via POST /api/auth/register-cabinet doivent toujours avoir leur propre organisationId distinct, et ne jamais Ãªtre rattachÃ©s Ã  default-org-001.

4. Adapter si nÃ©cessaire le storage pour crÃ©er une organisation

Si ce nâ€™est pas dÃ©jÃ  fait :

Ajouter dans server/storage.ts une mÃ©thode du type :

createOrganisation(data) â†’ qui insÃ¨re dans organisations et renvoie lâ€™instance crÃ©Ã©e.

Lâ€™utiliser dans la nouvelle route register-cabinet.

5. Me montrer le rÃ©sultat

Merci de me montrer :

le code de la nouvelle route POST /api/auth/register-cabinet dans auth.ts,

la mÃ©thode createOrganisation Ã©ventuelle dans storage.ts,

un exemple de body de requÃªte et de rÃ©ponse pour ce nouvel endpoint.

ğŸ¯ RÃ©sultat attendu :

Quand jâ€™appelle POST /api/auth/register-cabinet â†’ un nouveau cabinet est crÃ©Ã©.

Le user crÃ©Ã© est un ADMIN de ce cabinet.

Le JWT contient le organisationId de ce cabinet.

En utilisant ce JWT pour :

POST /api/patients

GET /api/patients

â€¦ je ne vois que les donnÃ©es de ce cabinet.