Mettre en place un environnement DEV / STAGING compl√®tement isol√©, connect√© exclusivement au projet Supabase DEV (base de donn√©es + Storage), sans aucun acc√®s ou √©criture sur l‚Äôenvironnement PROD.

1. Environnements cibles

L‚Äôapplication doit fonctionner avec deux environnements distincts :

üîπ Environnement DEV / STAGING

Backend ex√©cut√© sur Replit

Connect√© au projet Supabase DEV

Bucket Storage DEV : patient-documents (bucket priv√©)

üîπ Environnement PROD

Backend ex√©cut√© sur Render

Connect√© au projet Supabase PROD

Bucket Storage PROD : patient-documents (bucket priv√©)

Aucun partage de cl√©s, d‚ÄôURL ou de donn√©es entre les deux environnements.

2. Variables d‚Äôenvironnement (obligatoire)

Le code doit utiliser uniquement les variables g√©n√©riques suivantes :

SUPABASE_URL
SUPABASE_SERVICE_ROLE_KEY

Valeurs attendues :

DEV / STAGING (Replit)

SUPABASE_URL ‚Üí URL du projet Supabase DEV

SUPABASE_SERVICE_ROLE_KEY ‚Üí service_role key du projet Supabase DEV

PROD (Render)

SUPABASE_URL ‚Üí URL du projet Supabase PROD

SUPABASE_SERVICE_ROLE_KEY ‚Üí service_role key du projet Supabase PROD

‚ö†Ô∏è Aucun fallback, aucune valeur hardcod√©e, aucune variable _PROD / _DEV dans le code.

3. V√©rification au d√©marrage (obligatoire)

Au d√©marrage du backend, ajouter un log non sensible indiquant l‚Äôenvironnement cible, par exemple :

[Supabase] Connected to: https://<project-id>.supabase.co


(uniquement l‚ÄôURL, jamais les cl√©s)

Ce log permet de v√©rifier imm√©diatement que :

le staging parle bien au Supabase DEV,

la prod parle bien au Supabase PROD.

4. Comportement attendu

Tout upload effectu√© en DEV / STAGING :

√©crit uniquement dans le bucket Supabase DEV,

cr√©e des entr√©es uniquement dans la base Supabase DEV.

Aucune action DEV ne doit √©crire en PROD.

La PROD ne doit jamais d√©pendre de variables DEV.

5. S√©curit√©

La SUPABASE_SERVICE_ROLE_KEY est utilis√©e exclusivement c√¥t√© serveur.

Aucune cl√© Supabase n‚Äôest expos√©e au frontend.

Les acc√®s Storage passent par des signed URLs uniquement.

6. Crit√®re d‚Äôacceptation

Un upload en DEV appara√Æt uniquement dans Supabase DEV.

Un upload en PROD appara√Æt uniquement dans Supabase PROD.

Le log de d√©marrage confirme la cible Supabase correcte.

Aucun fichier de test DEV n‚Äôappara√Æt dans le bucket PROD.